(this.webpackJsonpwebsocketchat=this.webpackJsonpwebsocketchat||[]).push([[0],{2:function(e,t,n){e.exports={App:"App_App__3-2D1",nameBlock:"App_nameBlock__1bFcO",input:"App_input__3l-k3",button1:"App_button1__22zoa",chatBlock:"App_chatBlock__z8gJl",messages:"App_messages__25IV6",message:"App_message__1A7lT",enterMessageBlock:"App_enterMessageBlock__1Wafl",elem:"App_elem__14lQ_",button2:"App_button2__3DljB"}},49:function(e,t,n){},77:function(e,t){},80:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n(0),a=n.n(c),i=n(14),o=n.n(i),r=(n(49),n(9)),u=n(2),l=n.n(u),b=n(7),d=n(27),p=n(3),j=n(42),g=n.n(j),f={socket:null,createConnection:function(){this.socket=g()("https://konstantin-websocket-chat-back.herokuapp.com")},subscribe:function(e,t,n){var s,c,a;null===(s=this.socket)||void 0===s||s.on("init-messages-published",e),null===(c=this.socket)||void 0===c||c.on("new-message-sent",t),null===(a=this.socket)||void 0===a||a.on("user-is-typing",n)},destroyConnection:function(){var e;null===(e=this.socket)||void 0===e||e.disconnect(),this.socket=null},sendName:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-name-sent",e)},sendMessage:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-message-sent",e,(function(e){e&&alert(e)}))},typeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-typed")}},m={messages:[],typingUsers:[]},h=function(){var e=Object(b.c)((function(e){return e.chat.messages})),t=Object(b.c)((function(e){return e.chat.typingUsers})),n=Object(b.b)();Object(c.useEffect)((function(){return n((function(e){f.createConnection(),f.subscribe((function(t,n){e(function(e){return{type:"messages-received",messages:e}}(t)),n("data from front")}),(function(t){e(function(e){return{type:"new-message-received",message:e}}(t))}),(function(t){e(function(e){return{type:"add-typing-user",user:e}}(t))}))})),function(){n((function(e){f.destroyConnection()}))}}),[]);var a=Object(c.useState)(""),i=Object(r.a)(a,2),o=i[0],u=i[1],d=Object(c.useState)(""),p=Object(r.a)(d,2),j=p[0],g=p[1],m=Object(c.useState)(!0),h=Object(r.a)(m,2),O=h[0],v=h[1],k=Object(c.useState)(0),_=Object(r.a)(k,2),y=_[0],x=_[1];Object(c.useEffect)((function(){var e;O&&(null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[e]);var A=Object(c.useRef)(null);return Object(s.jsxs)("div",{className:l.a.App,children:[Object(s.jsxs)("div",{className:l.a.nameBlock,children:["Please, enter your nickname:",Object(s.jsx)("input",{className:l.a.input,onChange:function(e){return g(e.currentTarget.value)}}),Object(s.jsx)("button",{className:l.a.button1,onClick:function(){n(function(e){return function(t){f.sendName(e)}}(j))},children:"Enter"})]}),Object(s.jsxs)("div",{className:l.a.chatBlock,children:[Object(s.jsxs)("div",{className:l.a.messages,onScroll:function(e){var t=e.currentTarget,n=t.scrollHeight-t.clientHeight;t.scrollTop>y&&Math.abs(n-t.scrollTop)<5?v(!0):v(!1),x(e.currentTarget.scrollTop)},children:[e.map((function(e){return Object(s.jsxs)("div",{className:l.a.message,children:[Object(s.jsxs)("b",{children:[e.user.name,":"]})," ",e.message]},e.id)})),t.map((function(e){return Object(s.jsxs)("div",{children:[Object(s.jsx)("b",{children:e.name})," is typing..."]},e.id)})),Object(s.jsx)("div",{ref:A})]}),Object(s.jsxs)("div",{className:l.a.enterMessageBlock,children:[Object(s.jsx)("textarea",{className:l.a.elem,value:o,onKeyPress:function(){n((function(e){f.typeMessage()}))},onChange:function(e){return u(e.currentTarget.value)}}),Object(s.jsx)("button",{className:l.a.button2,onClick:function(){n(function(e){return function(t){f.sendMessage(e)}}(o)),u("")},children:"Send"})]})]})]})},O=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,81)).then((function(t){var n=t.getCLS,s=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),s(e),c(e),a(e),i(e)}))},v=n(6),k=n(43),_=Object(v.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"messages-received":return Object(p.a)(Object(p.a)({},e),{},{messages:t.messages});case"new-message-received":return Object(p.a)(Object(p.a)({},e),{},{messages:[].concat(Object(d.a)(e.messages),[t.message]),typingUsers:e.typingUsers.filter((function(e){return e.id!==t.message.user.id}))});case"add-typing-user":return Object(p.a)(Object(p.a)({},e),{},{typingUsers:[].concat(Object(d.a)(e.typingUsers.filter((function(e){return e.id!==t.user.id}))),[t.user])});default:return e}}}),y=Object(v.d)(_,Object(v.a)(k.a));o.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(b.a,{store:y,children:Object(s.jsx)(h,{})})}),document.getElementById("root")),O()}},[[80,1,2]]]);
//# sourceMappingURL=main.f0127683.chunk.js.map